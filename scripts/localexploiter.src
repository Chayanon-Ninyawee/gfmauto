get_custom_object.error = null

home_metaxploit = get_custom_object.home_metaxploit

metaxploit = include_lib("/home/guest/metaxploit.so")


get_result_list = @get_custom_object.get_result_list
get_local_metaLib_list = @get_custom_object.get_local_metaLib_list

result = get_result_list(get_local_metaLib_list(metaxploit))

shell_memory_exploit_map_list = result["shell"]
computer_memory_exploit_map_list = result["computer"]
file_memory_exploit_map_list = result["file"]

current_script_file = null
metaxploit_file = null
passwd_file = null

for shell_memory_exploit_map in shell_memory_exploit_map_list
    shell = shell_memory_exploit_map["shell"]
    hostComputer = shell.host_computer

    current_script_file_in = hostComputer.File(current_path+"/localexploiter")
    if not current_script_file_in then continue
    if not current_script_file_in.has_permission("w") then continue
    current_script_file = current_script_file_in
    break
end for

for shell_memory_exploit_map in shell_memory_exploit_map_list
    shell = shell_memory_exploit_map["shell"]
    hostComputer = shell.host_computer

    metaxploit_file_in = hostComputer.File("/home/guest/metaxploit.so")
    if not metaxploit_file_in then continue
    if not metaxploit_file_in.has_permission("w") then continue
    metaxploit_file = metaxploit_file_in
    break
end for

for shell_memory_exploit_map in shell_memory_exploit_map_list
    shell = shell_memory_exploit_map["shell"]
    hostComputer = shell.host_computer

    passwd_file_in = hostComputer.File("/etc/passwd")
    if not passwd_file_in then continue
    if not passwd_file_in.has_permission("r") then continue
    passwd_file = passwd_file_in
    break
end for

if not current_script_file == null then; current_script_file.delete()
else; get_custom_object.error = "Don't have write permission or can't find current script file in the current folder"; end if

if not metaxploit_file == null then; metaxploit_file.delete()
else; get_custom_object.error = "Don't have write permission or can't find metaxploit.so file in the current folder"; end if

if not passwd_file == null then; get_custom_object.target_password_hash = passwd_file.get_content
else; get_custom_object.error = "Don't have read permission or can't find /etc/passwd"; end if